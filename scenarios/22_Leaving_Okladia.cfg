#textdomain wesnoth-A_New_Order
[scenario]
    name = _ "Leaving Okladia"
    id=22_Leaving_Okladia
    map_data="{~add-ons/A_New_Order/maps/LeavingOkladia.map}"
    next_scenario=23d_Trapped

    {INTRO_AND_SCENARIO_MUSIC siege_of_laurelmor.ogg the_city_falls.ogg}
    {EXTRA_SCENARIO_MUSIC northern_mountains.ogg}
    {EXTRA_SCENARIO_MUSIC siege_of_laurelmor.ogg}
    {EXTRA_SCENARIO_MUSIC battle/onethousandsuns.ogg}
    {EXTRA_SCENARIO_MUSIC weight_of_revenge.ogg}
    {EXTRA_SCENARIO_MUSIC northerners.ogg}
    {EXTRA_SCENARIO_MUSIC theme_of_a_new_order.ogg}
    {EXTRA_SCENARIO_MUSIC battle/ambuscade.ogg}
    {TURNS4 18 16 14 12}

    {COUNT_DEATHS_PERSISTENT bride bride_deaths}
    [story]
        [part]
            #po: spoken by Gawen
            story=_"When Deorien declared to my soldiers that they should address me by the name of 'King Gawen Haldric Hagarthen,' they showed a great deal of enthusiasm. I think this title was of little surprise to them. But their raucous enthusiasm was surely a surprise to me."
        [/part]
        [part]
            story=_"We had hoped that our small army could sneak successfully out of Okladia, but on the border we marched suddenly into outposts of the Okladian army. With scouts reporting that King Buffin's main army was at our backs, we had no time for finding another way. We had to hew our way through Akladian ranks."
        [/part]
    [/story]

    {DAWN}
    {MORNING}
    {AFTERNOON}
    {DUSK}
    {FIRST_WATCH}
    {SECOND_WATCH}

    victory_when_enemies_defeated=yes
    {STARTING_VILLAGES 3 {ON_DIFFICULTY4 14 15 16 17}}
    {STARTING_VILLAGES 4 {ON_DIFFICULTY4 6 7 8 9}}
    {STARTING_VILLAGES 2 {ON_DIFFICULTY4 6 7 8 9}}
    {PLACE_IMAGE (scenery/signpost.png) 30 15}
#define MSG_Bal_Riddon _TEXT
    {MESSAGE (Bal Riddon) () (_"Bal Riddon") ({_TEXT})}
#enddef
#define CHANGE_RAUKE A X Y
    [modify_side]
        side=2
        team_name=good
    [/modify_side]

    {VARIABLE ano_tmp_x ({X})}
    {VARIABLE ano_tmp_y ({Y})}
    {VARIABLE_OP ano_tmp_x add -1}
    {VARIABLE_OP ano_tmp_y add -1}

    [teleport]
        [filter]
            x={X}
            y={Y}
        [/filter]
        x,y=$ano_tmp_x,$ano_tmp_y
    [/teleport]
    [redraw]
    [/redraw]

    {CLEAR_VARIABLE ano_tmp_x}
    {CLEAR_VARIABLE ano_tmp_y}
    [if]
        [have_unit]
            # wmllint: recognize Bal Riddon
            id=Bal Riddon
            side=3
        [/have_unit]
        [then]
            {MSG_Bal_Riddon _"Treacherous dog! Harnen has joined the rebels! Bring reinforcements!"}
            {MSGm_Gawen _"Bring it on! We have our own reinforcements!"}
            # wmllint: recognize Rauke Harnen
            {MSG_Rauke _"As do we!"}
            [gold]
                side=1 # side 1 is the default when unspecified
                amount={ON_DIFFICULTY4 150 135 120 105}
            [/gold]
            [gold]
                side=3 # Given the message from Bal Riddon above, though, side 3 is probably what was actually intended
                amount={ON_DIFFICULTY4 100 110 120 130}
            [/gold]
            [gold]
                side=2 # ...and add some for Rauke, too, just for fun
                amount={ON_DIFFICULTY4 140 130 120 110}
            [/gold]
            # In case the other enemies are overpowering Rauke, give him a bit of an extra chance:
            [event]
                name=attack
                [filter]
                    side=3,4
                [/filter]
                [filter_second]
                    id=Rauke Harnen
                [/filter_second]
                [modify_side]
                    side=2
                    # all higher than previous income of {1 2 3 4}, except now decreasing with difficulty instead of increasing:
                    {INCOME4 9 8 7 6}
                [/modify_side]
            [/event]
            # Also do one the other way around:
            [event]
                name=attack
                [filter]
                    id=Rauke Harnen
                [/filter]
                [filter_second]
                    side=3,4
                [/filter_second]
                [gold]
                    side=2
                    amount={ON_DIFFICULTY4 44 33 22 11}
                [/gold]
            [/event]
        [/then]
    [/if]
    # so he can make it back to base to recruit more:
    [heal_unit]
        [filter]
            # wmllint: recognize Gawen Hagarthen
            id=Gawen Hagarthen
        [/filter]
        amount={ON_DIFFICULTY4 (full) 2 1 0}
        moves={ON_DIFFICULTY4 (full) 2 1 0}
        restore_attacks=yes
    [/heal_unit]
#enddef

#define GAWEN_ATTACKING A X Y
    # The "${A}.name" formulation here is to prevent the caption from being displayed as literally "second_unit":
    {MESSAGE ({A}) () (${A}.name) _"Wait! Before we cross our blades, I must know something. Tell me your name: for I think I saw your face some time ago, and now... Maybe I heard it wrong, but aren't your people calling you Gawen Hagarthen?"}
    {MSGm_Gawen _"I am Gawen Hagarthen."}
    {MESSAGE ({A}) () (${A}.name) _"Gawen Hagarthen, king of Vakladia?"}
    {MSGm_Gawen _"I am Gawen Hagarthen. I was crowned king in Vattin and betrayed by my own lords during the battle of Barnon."}
    {IF ano_harnen equals spared}
    {IF ano_harnen_heard equals gawen}
    {MSG_Rauke _"Stop fighting! This is our rightful king. My brother told me the truth, then. I am your hand, my sword is your sword, my king, my blood is yours to spill."}
    {CHANGE_RAUKE ({A}) ({X}) ({Y})}
    {ELSE}
    {MSG_Rauke _"Gawen Hagarthen? But.. you were fighting with Raban Harnen, my brother recently, isn't that right?"}
    {MSGm_Gawen _"Yes, I was."}
    {MSG_Rauke _"He asked you for your name, and you answered your name was Gaumhaldric. Either you are lying now or you were lying then. A base liar couldn't be the rightful king of the Akladian people. Prepare to die!"}
    {END_IF}
    {ELSE_IF ano_harnen equals killed}
    {MSG_Rauke _"My brother... my brother died... he was killed by someone called 'Gaumhaldric.' Do you... do you know who 'Gaumhaldric' is?"}
    {MSGOPTI2 (Gawen Hagarthen) (portraits/gawen_was.png) (_"Well...")
    (_"This was a name I used in the past.") (yes)
    (_"No idea who he could be.") (no)
    }
    {IF ano_opt equals no}
    {MSG_Rauke _"Liar! I know you fought under the name Gaumhaldric. I was only checking to see whether you would have the courage to admit that. A base liar couldn't be the rightful king of the Akladian people. Prepare to die!"}
    {ELSE}
    {MSG_Rauke _"So, you killed my brother!"}
    {MSGOPTI2 (Gawen Hagarthen) (portraits/gawen_was.png) (_"Well...")
    (_"Yes. It was good fight and your brother was brave fighter.") (yes)
    (_"Yes. Now it will be your turn.") (no)
    }
    {IF ano_opt equals no}
    {MSG_Rauke _"We will see who will kill whom. Prepare to die!"}
    {ELSE}
    {MSG_Rauke _"He had an honourable death. My king, my brother only opposed you because he didn't know it was you. Please, forgive him."}
    {MSGm_Gawen _"I honour the memory of your brother. He did nothing which would have to be forgiven."}
    {MSG_Rauke _"Stop fighting! This is our rightful king. I am your hand, my sword is your sword, my king, my blood is yours to spill."}
    {CHANGE_RAUKE ({A}) ({X}) ({Y})}
    {END_IF}
    {END_IF}
    {ELSE} #left
    {MSG_Rauke _"My brother fought with soldiers led by someone called 'Gaumhaldric.' Do you.. Do you know who Gaumhaldric is?"}
    {MSGOPTI2 (Gawen Hagarthen) (portraits/gawen_was.png) (_"Well...")
    (_"This was a name I used in the past.") (yes)
    (_"No idea who he could be.") (no)
    }
    {IF ano_opt equals no}
    {MSG_Rauke _"Liar! I know you fought under the name Gaumhaldric. I was only checking to see whether you would have the courage to admit that. A base liar couldn't be the rightful king of the Akladian people. Prepare to die!"}
    {ELSE}
    {MSG_Rauke _"My king, my brother only opposed you because he didn't know it was you. Please, forgive him."}
    {MSGm_Gawen _"I honour the memory of your brother. He did nothing which would have to be forgiven."}
    {MSG_Rauke _"Stop fighting! This is our rightful king. I am your hand, my sword is your sword, my king, my blood is yours to spill."}
    {CHANGE_RAUKE ({A}) ({X}) ({Y})}
    {END_IF}
    {TWO_END_IFs}

#enddef

    [side]
        controller=human
        id=Gawen Hagarthen
        name=_"Gawen Hagarthen"
        type=Hagarthen
        profile=portraits/gawen_was.png
        team_name=good
        canrecruit=yes
        unrenamable=yes
        side=1
        {GOLD4 190 170 150 130}
        {INCOME4 3 2 1 0}
    [/side]

    #cousin of Raban Harnen (western encampment at 4,16)
    [side]
        side=2
        id=Rauke Harnen
        name=_"Rauke Harnen"
        controller=ai
        canrecruit=yes
        team_name=bad
        facing=se
        type=Akladian Lord
        recruit=Akladian Clansman,Akladian Warrior,Akladian Light Infantry,Akladian Raider,Akladian Sturmknight,Akladian Darknite
        {GOLD4 100 125 150 175}
        {INCOME4 1 2 3 4}
        [ai]
            simple_targeting=yes
            caution=0.5
            aggression=0.5
            grouping=offensive
        [/ai]
        [ai]
            time_of_day=dusk,first_watch,second_watch
            aggression=1.0
            caution=0.0
            grouping=no
        [/ai]
    [/side]

    #One lord to rule them all (central keep at 18,17)
    [side]
        controller=ai
        id=Bal Riddon
        name=_"Bal Riddon"
        type=Akladian Lord
        team_name=bad
        canrecruit=yes
        side=3
        facing=se
        recruit=Akladian Holyman,Akladian Wonderman,Akladian Pikeneer,Akladian Warrior,Akladian Light Infantry,Akladian Darknite,Akladian Sturmknight,Akladian Raider
        {GOLD4 200 255 310 365}
        {INCOME4 1 4 7 10}
        [ai]
            recruitment_pattern=fighter,1,2,1,fighter,healer,fighter
#ifdef EASY
            [goal]
                [criteria] #NOTE: this is a SUF, because we're targeting a unit
                    id=Gawen Hagarthen
                [/criteria]
                value=75
            [/goal]
#else
            [goal]
                [criteria] #NOTE: this is a SUF, because we're targeting a unit
                    id=Gawen Hagarthen
                [/criteria]
                value=100
            [/goal]
            [goal]
                [criteria] #NOTE: this is a SUF, because we're targeting a unit
                    id=Lady Lorin
                [/criteria]
                value=100
            [/goal]
            [goal]
                [criteria] #NOTE: this is a SUF, because we're targeting a unit
                    id=Ruvio
                [/criteria]
                value=100
            [/goal]
#endif
        [/ai]
        [ai]
            time_of_day=dawn,morning,afternoon
            caution=0.3
            aggression=0.6
            grouping=offensive
        [/ai]
        [ai]
            time_of_day=dusk,first_watch,second_watch
            caution={ON_DIFFICULTY4 0.21 0.14 0.07 0.00}
            aggression={ON_DIFFICULTY4 0.7 0.8 0.9 1.0}
            grouping=no
#ifdef EASY
            simple_targeting=yes
#endif
        [/ai]
    [/side]

    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 "Akladian Wonderman" {ON_DIFFICULTY4 1 2 3 4}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 "Akladian Darknite" {ON_DIFFICULTY4 1 2 3 4}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 "Akladian Pikeneer" {ON_DIFFICULTY4 1 2 3 4}}

    # North encampment at 16,2:
    [side]
        controller=ai
        id=Dauri Travil
        name=_"Dauri Travil"
        type=Akladian Lord
        team_name=bad
        canrecruit=yes
        side=4
        facing=se
        recruit=Akladian Pikeneer,Akladian Fastfoot,Akladian Light Infantry,Akladian Darknite,Akladian Sturmknight,Akladian Raider,Akladian Holyman,Akladian Wonderman
        {GOLD4 200 240 280 320}
        {INCOME4 1 3 5 7}
        [ai]
            recruitment_pattern=fighter,1,2,1,fighter,healer,fighter
        [/ai]
        [ai]
            {NO_SCOUTS}
            time_of_day=dawn,morning,afternoon
            caution=0.3
            aggression=0.6
            grouping=offensive
        [/ai]
        [ai]
            {NO_SCOUTS}
            time_of_day=dusk,first_watch,second_watch
            caution={ON_DIFFICULTY4 0.21 0.14 0.07 0.00}
            aggression={ON_DIFFICULTY4 0.7 0.8 0.9 1.0}
            grouping=no
#ifdef EASY
            simple_targeting=yes
#endif
        [/ai]
    [/side]

    {LIMIT_CONTEMPORANEOUS_RECRUITS 4 "Akladian Wonderman" {ON_DIFFICULTY4 1 2 3 4}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 4 "Akladian Darknite" {ON_DIFFICULTY4 1 2 3 4}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 4 "Akladian Pikeneer" {ON_DIFFICULTY4 1 2 3 4}}

    # Enemy reinforcements (vanguard of King Buffin's army):
    [side]
        controller=ai
        team_name=bad
        canrecruit=yes
        side=5
        recruit=Akladian Pikeneer,Akladian Fastfoot,Akladian Light Infantry,Akladian Darknite,Akladian Sturmknight,Akladian Raider,Akladian Holyman,Akladian Wonderman
        no_leader=yes
        {GOLD4 200 235 270 305}
        {INCOME4 1 3 5 7}
        [ai]
            recruitment_pattern=fighter,1,2,1,fighter,healer,fighter
        [/ai]
        [ai]
            {NO_SCOUTS}
            time_of_day=dawn,morning,afternoon
            caution=0.3
            aggression=0.6
            grouping=offensive
        [/ai]
        [ai]
            {NO_SCOUTS}
            time_of_day=dusk,first_watch,second_watch
            caution={ON_DIFFICULTY4 0.21 0.14 0.07 0.00}
            aggression={ON_DIFFICULTY4 0.7 0.8 0.9 1.0}
            grouping=no
        [/ai]
    [/side]

    {LIMIT_CONTEMPORANEOUS_RECRUITS 5 "Akladian Wonderman" {ON_DIFFICULTY4 1 2 3 4}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 5 "Akladian Darknite" {ON_DIFFICULTY4 1 2 3 4}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 5 "Akladian Pikeneer" {ON_DIFFICULTY4 1 2 3 4}}

    # wmllint: recognize Reme Carrenemoe
    # wmllint: recognize Lady Lorin
    # wmllint: recognize Deorien
    # wmllint: recognize Reumario
    [event]
        name=prestart
        {VARIABLE ano_first_time true}
        {RECALLXY (Lady Lorin) 20 30}
        {IF_HAVE_UNIT_ANY (Reme Carrenemoe)}
        {RECALLXY (Reme Carrenemoe) 20 29}
        {ELSE}
#ifdef NIGHTMARE
        [terrain]
            x,y=20,29
            layer=overlay
            terrain="^Edb"
        [/terrain]
#else
        {GENERIC_UNIT 1 Peasant 20 29}
#endif
        {END_IF}
        {RECALLXY (Deorien) 21 29}
        {IF_HAVE_UNIT_ANY (Reumario)}
        {RECALLXY (Reumario) 21 31}
        {ELSE}
#ifdef NIGHTMARE
        [terrain]
            x,y=21,31
            layer=overlay
            terrain="^Edt"
        [/terrain]
#else
        {GENERIC_UNIT 1 Peasant 21 31}
#endif
        {END_IF}
        [terrain]
            x=26
            y=31
            terrain=Gg
        [/terrain]
#ifdef EASY
        [terrain]
            x,y=19,30
            terrain=Re^Vct
        [/terrain]
        {GENERIC_UNIT 1 Mage 22 29}
        {GENERIC_UNIT 1 Mage 22 30}
#endif
    [/event]

    [event]
        name=start
        [scroll_to_unit]
            id=Bal Riddon
        [/scroll_to_unit]
        [redraw][/redraw]
        [modify_unit]
            [filter]
                id=Bal Riddon
            [/filter]
            facing=sw
        [/modify_unit]
        [redraw][/redraw]
        {MSG_Bal_Riddon _"Have you heard, Rauke? You will have another king very soon now."}
        {MSG_Rauke _"No kidding."}
        {MSG_Bal_Riddon _"No, really. Now, when Gawen Hagarthen was killed and you were unable to impose any sign of order, our king, which as it seems will soon be also your king, decided to help you and bring back the law."}
        {MSG_Rauke _"No kidding."}
        {MSG_Bal_Riddon _"After he cleans Vakladia of the marauders, brawlers and bandits, he will call for an election for a new king, where you, of course, will have the chance to show your gratitude by giving him the crown."}
        {MSG_Rauke _"Are you going somewhere with this speech, or are you just talking because you love to hear yourself talk?"}
        {MSG_Bal_Riddon _"Well, Rauke, what will you do when King Buffin Hagarthen appears here? You will of course join us? I know a few people who are quite close to the king, I might just put in a good word with them for you..."}
        {IF ano_harnen equals spared}
        {IF ano_harnen_heard equals gawen}
        {MSG_Rauke _"Anyone who tries to pass my outpost with arms in his hands and treachery in his heart will never return to his home. Gawen Hagarthen is alive. My brother Raban saw him and even talked with him. He is our rightful king and he will return to us."}
        {ELSE}
        {MSG_Rauke _"I will do as my heart leads me. Not long ago, my brother fought a Wesnothian leader, Gaumhaldric. He told me this Gaumhaldric looked just like our king Gawen... but when asked, he answered that his name was 'Gaumhaldric.' I think our throne must be empty. Either Gawen is dead, or - if he indeed was Gaumhaldric - he lied and is therefore unworthy to be our king."}
        {END_IF}
        {ELSE_IF ano_harnen equals killed}
        {MSG_Rauke _"I don't know what to think about this. My brother, Raban, died recently fighting with someone who - according to many - looked like our king Gawen's twin brother."}
        {ELSE} # case where Raban Harnen left:
        {MSG_Rauke _"I don't know what to think about this. My brother, Raban, fought with someone who - according to many - looked like our king Gawen's twin brother. He was left alive by one of the Wesnothians fighting for this young leader, who goes by the name 'Gaumhaldric.' There are many rumors about him..."}
        {TWO_END_IFs}

        {IF_HAVE_UNIT (Reme Carrenemoe)}
        {MSGm_Reme _"This doesn't look good, my lord. We weren't expecting this many enemies here. And our scouts are reporting that Buffin's army is just behind us."}
        {ELSE}
        {IF_HAVE_UNIT (Reumario)}
        {MSG_Reumario _"This doesn't look good, my lord. We weren't expecting this many enemies here. And our scouts are reporting that Buffin's army is just behind us."}
        {END_IF_WITHOUT_ELSE}
        {END_IF}

        {MSGm_Lorin _"Aaah, the glory of battle! My son, fodder for our swords lies ahead. Let's kill them all, and if they are worthy opponents, let's cut their hearts out and eat them. Speaking of eating, I am really hungry..."}
        {MSG_Deorien _"My king, is mother of your majesty always this... hmm..."}
        {MSGm_Gawen _"Bloodthirsty? I am not sure. She has been behaving very oddly of late... mother, you should really stop eating so much. You are starting to gain weight."}
        {MSGm_Lorin _"I will lose it in battle. Charge!"}

        [objectives]
            side=1
            [objective]
                description=_"Kill all enemy leaders OR"
                condition=win
            [/objective]
            [objective]
                description=_"Reach the northern edge of the map with Gawen."
                condition=win
            [/objective]
            [objective]
                description=_"Death of Gawen Hagarthen"
                condition=lose
            [/objective]
            [objective]
                description=_"Death of Deorien"
                condition=lose
            [/objective]
            [objective]
                description=_"Death of Lady Lorin"
                condition=lose
            [/objective]
            {TURNS_RUN_OUT}
        [/objectives]
    [/event]

    [event]
        name=attack
        [filter]
            side=1
            [not]
                id=Gawen Hagarthen
            [/not]
            [not]
                id=Lady Lorin
            [/not]
            [not]
                id=Deorien
            [/not]
            [not]
                id=Reumario
            [/not]
            [not]
                id=Reme Carrenemoe
            [/not]
        [/filter]
        [filter_second]
            [not]
                side=2
            [/not]
        [/filter_second]
        {MSG_unit _"For our king, Gawen Haldric Hagarthen!"}
        {MESSAGE (second_unit) () ($second_unit.name) _"Your king? You are fighting for the ghost of long dead boy? And why would you call him Haldric?"}
    [/event]

    [event]
        name=attack
        [filter]
            side=1
            [not]
                id=Gawen Hagarthen
            [/not]
            [not]
                id=Lady Lorin
            [/not]
            [not]
                id=Deorien
            [/not]
            [not]
                id=Reumario
            [/not]
            [not]
                id=Reme Carrenemoe
            [/not]
        [/filter]
        [filter_second]
            side=2
        [/filter_second]
        {MSG_unit _"You oppose Gawen Hagarthen, your own king."}
        {MESSAGE (second_unit) () ($second_unit.name) _"Our king? And where is he? Is he hiding behind your backs?"}
    [/event]

    [event]
        name=attack
        [filter]
            id=Deorien
        [/filter]
        {MSG_Deorien _"Now, feel the wrath of ancient power. Your God is expressing his anger through me, because you are opposing his messiah!"}
    [/event]

    [event]
        name=attack
        [filter]
            id=Gawen Hagarthen
        [/filter]
        [filter_second]
            side=2
        [/filter_second]
        # The problem I was having here should be fixed above for now:
        {GAWEN_ATTACKING (second_unit) ($x2) ($y2)}
    [/event]

    [event]
        name=attack
        [filter]
            id=Reme Carrenemoe
        [/filter]
        [filter_second]
            side=2
        [/filter_second]
        {MSGm_Reme _"You oppose Gawen Hagarthen, your own king."}
        {MESSAGE (second_unit) () ($second_unit.name) _"Our king? And where is he? Is he hiding behind your backs?"}
        {MSGm_Reme _"My name is Reme Carrenemoe. You doubt my word?"}
        {MESSAGE (second_unit) () ($second_unit.name) _"If he is really Gawen Hagarthen, why does he send others to fight?"}
    [/event]
    [event]
        name=attack
        [filter]
            side=2
        [/filter]
        [filter_second]
            id=Gawen Hagarthen
        [/filter_second]
        {GAWEN_ATTACKING (unit) ($x1) ($y1)}
    [/event]

    #INTERROGATIONS
    [event]
        name=die
        [filter]
            id=Dauri Travil
        [/filter]
        [filter_second]
            side=1
        [/filter_second]
        {MSGm_Gawen _"He lost consciousness already? Sigh. I hoped we could ask him few questions. But then again, he didn't seem like a guy who would actually KNOW anything."}
    [/event]

    # Rauke Harnen
    [event]
        {KILLEDBY (Rauke Harnen) (Gawen Hagarthen)}
        {MSG_Rauke _"What are you waiting for? Finish me!"}
        {MSGOPTI2 (Gawen Hagarthen) (portraits/gawen_was.png) (_"Well...")
        (_"Then die, if that's what you want!") (die)
        (_"You were worthy opponent") (worthy)
        }

        {IF ano_opt equals die}
        {MSGm_Gawen _"If that's your wish"}
        {VARIABLE ano_rauke killed_by_gawen}
        {ELSE}
        {MSGm_Gawen _"Why should I do that? You fought like a real man, and I respect you. Rauke, I want you to know that I consider you a good warrior and a fine Akladian. I will ensure your body is buried with all honours."}
        {VARIABLE ano_rauke honoured}
        {MSG_Rauke _"Maybe you are worthy to be our king after all..."}
        {MSGm_Gawen _"Tell me what has happened recently in Vakladia?"}

        {MSG_Rauke _"Nothing changed much. Everyone is fighting with everyone. Bor Cryne and his allies are trying to impose themselves as supreme rulers with the help of the orcs, but even their successes with the rebels have not given them any authority."}
        {MSG_Rauke _"In Easkladia, king Perien died during the final battle with the Wesnothians. He broke through the Wesnothian lines right to their king. He slew their king, but he was in turn killed by underlings. The battle then ended, undecided, but the Easkladian capital was saved and the underlings withdrew without their king."}
        {MSG_Rauke _"There are multiple rumors about a messiah who will come and unite all the Akladians and lead them into true greatness... (<i>coughs</i>) ...and... (<i>coughs</i>)"}
        {MSGm_Gawen _"He is dead now. Lie in peace, warrior. I will keep my promise"}
        {END_IF}
    [/event]
    [event]
        {KILLEDBY (Rauke Harnen) (Deorien)}
        {MSG_Rauke _"A mage! A mage has defeated me! A creature from the dark past allied with you? God will punish you!"}
    [/event]
    [event]
        {KILLEDBY (Rauke Harnen) (Lady Lorin)}
        {MSGm_Lorin _"Rauke, I like you. That's why I don't want you to scream in pain and agony. What do you say you help me out?"}
        {MSG_Rauke _"Help yourself, fat witch."}
        {MSGm_Lorin _"Fat? That's really unfair. I didn't say anything about you being bald. Now, tell me what happened recently in Vakladia, and..."}
        {MSGOPTI2 (Lady Lorin) (potraits/lorin_wilczyca.png) (_"And...")
        (_"You will avoid unspeakable pain") (pain)
        (_"I will honour you by burying you properly") (bury)
        }

        {IF ano_opt equals pain}
        {VARIABLE ano_rauke killed_by_lorin}
        {MSG_Rauke _"You think you can frighten me with mere words? Ha! Ha! Ha! I am an Akladian lord, and I am not afraid... I am half-dead already..."}
        {MSGm_Lorin _"Only half-dead, mind you. It means you can still feel the pain"}
        {MSG_Rauke _"Aaargh! No! Not there! Aaargh! Stop, stop it!"}
        {MSGm_Gawen _"I won't allow for any more of that, mother. Stop it! Stop it right now!"}
        {MSGm_Lorin _"Oh, rats, I think I've lost my delicate, feminine touch. My blade slipped and I've killed him too soon. Sigh."}
        {ELSE}
        {VARIABLE ano_rauke honoured}
        {MSG_Rauke _"Honour me? That's so.. so unlikely of you, Lorin."}
        {MSGm_Lorin _"LADY Lorin, if you don't mind. How do you know what's unlikely for me? You were a fine warrior, and I grow tired of being called emotionless and cruel by my step-son. Would you please tell me about what happened in Vakladia recently?"}
        {MSG_Rauke _"Nothing's changed much. Everyone is fighting with everyone. Bor Cryne and his allies are trying to impose themselves as supreme rulers with the help of the orcs, but even their successes with the rebels have not given them any authority."}
        {MSG_Rauke _"In Easkladia, king Perien died during the final battle with the Wesnothians. He broke through the Wesnothian lines right to their king. He slew their king, but he was in turn slain by underlings. The battle then ended, undecided, but the Easkladian capital was saved and the underlings withdrew without their king."}
        {MSG_Rauke _"There are multiple rumors about a messiah who will come and unite all the Akladians and lead them into true greatness... (<i>coughs</i>) ...and... (<i>coughs</i>)"}
        {MSGm_Lorin _"He is dead now. Lie in peace, warrior. I will keep my promise"}
        {END_IF}
    [/event]
    [event]
        {KILLEDBY (Rauke Harnen) (Reme Carrenemoe)}
        {MSGm_Reme _"You were a worthy fighter, noble Rauke Harnen. I will do everything to bury your body properly according to our customs."}
        {MSG_Rauke _"So were you, noble Reme. I've heard about the fate of your clan and family - please, accept my deepest condolences."}
        {MSGm_Reme _"People die and join their ancestors. I am happy their death was honourable. Please, before you die - could you tell me about what happened in Vakladia recently?"}
        {MSG_Rauke _"Nothing's changed much. Everyone is fighting with everyone. Bor Cryne and his allies are trying to impose themselves as supreme rulers with the help of the orcs, but even their successes with the rebels have not given them any authority."}
        {MSG_Rauke _"In Easkladia, king Perien died during the final battle with the Wesnothians. He broke through the Wesnothian lines right to their king. He slew their king, but he was in turn slain by underlings. The battle then ended, undecided, but the Easkladian capital was saved and the underlings withdrew without their king."}
        {MSG_Rauke _"There are multiple rumors about a messiah who will come and unite all the Akladians and lead them into true greatness... (<i>coughs</i>) ...and... (<i>coughs</i>)"}
        {VARIABLE ano_rauke honoured}
        {MSGm_Reme _"He is dead now. Lie in peace, warrior. I will keep my promise"}
    [/event]
    [event]
        name=die
        [filter]
            id=Rauke Harnen
        [/filter]
        [filter_second]
            side=1
        [/filter_second]
        {MSGm_Gawen _"Hmm... seems that he had some gold..."}
        {VARIABLE gold_amt {ON_DIFFICULTY4 70 60 50 40}}
        [gold]
            amount=$gold_amt
            side=1
        [/gold]
        {MSG_narrator _"You have received $gold_amt gold pieces."}
        {CLEAR_VARIABLE gold_amt}
    [/event]
#ifdef NIGHTMARE
    [event]
        name=die
        [filter]
            id=Rauke Harnen
        [/filter]
        [filter_second]
            side=3
        [/filter_second]
        {MSG_Bal_Riddon _"Hmm... seems that the traitor had some gold..."}
        [gold]
            amount=40
            side=3
        [/gold]
        {MSG_narrator _"Bal Riddon has received 40 gold pieces."}
    [/event]
    [event]
        name=die
        [filter]
            id=Rauke Harnen
        [/filter]
        [filter_second]
            side=4
        [/filter_second]
        {MESSAGE (Dauri Travil) () (_"Dauri Travil") _"Hmm... seems that the traitor had some gold..."}
        [gold]
            amount=40
            side=4
        [/gold]
        {MSG_narrator _"Dauri Travil has received 40 gold pieces."}
    [/event]
#endif

    [event]
        name=die
        [filter]
            id=Bal Riddon
        [/filter]
        {MESSAGE (Dauri Travil) () (_"Dauri Travil") _"Eeek! They killed the boss! Bring reinforcements!"}
        [gold]
            amount={ON_DIFFICULTY4 100 110 120 130}
            side=4
        [/gold]
#ifdef NIGHTMARE
        {IF_NOT_HAVE_CREATE_LOYAL 4 (Akladian Clansman) 15 2}
        {IF_NOT_HAVE_CREATE_LOYAL 4 (Akladian Clansman) 15 3}
        {IF_NOT_HAVE_CREATE_LOYAL 4 (Akladian Clansman) 16 1}
        {IF_NOT_HAVE_CREATE_LOYAL 4 (Akladian Clansman) 16 3}
        {IF_NOT_HAVE_CREATE_LOYAL 4 (Akladian Clansman) 17 2}
        {IF_NOT_HAVE_CREATE_LOYAL 4 (Akladian Clansman) 17 3}
#endif
    [/event]

    [event]
        name=die
        [filter]
            id=Rauke Harnen
        [/filter]
        [filter_second]
            side=1
            [not]
                id=Gawen Hagarthen
            [/not]
            [not]
                id=Reme Carrenemoe
            [/not]
            [not]
                id=Lady Lorin
            [/not]
        [/filter_second]
        {VARIABLE ano_rauke killed}
    [/event]

    # Bal Riddon
    [event]
        {KILLEDBY (Bal Riddon) (Gawen Hagarthen)}
        {MSGm_Gawen _"Bal Riddon, before you die, I want you to tell me a few things about the plans of your king, Buffin."}
        {MSG_Bal_Riddon _"Ask him yourself, then. I won't tell you anything."}
    [/event]
    [event]
        {KILLEDBY (Bal Riddon) (Deorien)}
        {MSG_Bal_Riddon _"A mage! A mage has defeated me! A creature from the dark past allied with you? God will punish you!"}
    [/event]
    [event]
        {KILLEDBY (Bal Riddon) (Lady Lorin)}
        {MSGm_Lorin _"Bal Riddon, before you die, I want you to tell me a few things about the plans of your king, Buffin."}
        {MSG_Bal_Riddon _"Ask him yourself, then. I won't tell you anything."}
        {MSGm_Lorin _"Nonono, you have not understood me. I WANT you to tell me few things about the plans of your king. Now, we will start with the basics."}
        {MSG_Bal_Riddon _"Wait! I will tell you what I know. King Buffin wants to use the opportunity he sees here, with Gawen dead, Perien dead, and the two other Hagarthens in Guilcorta busy with quarrels. He wants to trump up some fake election and elect himself king of Vakladia."}
        {MSGm_Lorin _"Gawen is not dead, I assure you."}
        {MSG_Bal_Riddon _"But there is something strange... I've heard strange rumors. Something is happening at our eastern border. Many of the lords from the eastern part of Okladia have not answered the call of Buffin to assemble at his camp."}
        {MSGm_Lorin _"Okladian lords are cowards, what's so strange about that? Do you know anything else? No? Die then."}
        {VARIABLE ano_riddon_eastern yes}
    [/event]
    [event]
        {KILLEDBY (Bal Riddon) (Reme Carrenemoe)}
        {MSGm_Reme _"You were worthy fighter, noble Bal Riddon"}
        {MSG_Bal_Riddon _"So were you, Reme. So were you. You behaved honourably, so before I die, I want to warn you: you are headed straight into a trap."}
        {MSGm_Reme _"What do you mean by that?"}
        {MSG_Bal_Riddon _"An army of orcs and Akladians is gathering north of here. They are probably there because they want to head off the army of my king, Buffin. You will be trapped between those two armies. Go back to Okladia and try to find another way."}
        {MSGm_Reme _"We have no choice. We have to tread this path."}
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            x,y=30,15
        [/filter]
        [message]
            speaker=narrator
            image="scenery/signpost.png"
            #po: TODO: think of something better to put here:
            message= _ "This signpost is illegible, unfortunately."
        [/message]
    [/event]

    #TIMEOVER
    [event]
        name=time over
        [scroll_to]
            x,y=21,30 # starting keep
        [/scroll_to]
        [lock_view][/lock_view]
        {IF_NOT_HAVE_CREATE_LOYAL 5 (Akladian Clansman) 23 32}
        {IF_NOT_HAVE_CREATE_LOYAL 5 (Akladian Clansman) 24 32}
        {IF_NOT_HAVE_CREATE_LOYAL 5 (Akladian Clansman) 25 32}
        {SCATTER_UNITS 30 "Akladian Protector,Akladian Darknite,Akladian Fastfoot,Akladian Pikeneer" 2 (
            x=1-32
            y=23-32

            [not]
                terrain=Ww
            [/not]

            [not]
                [filter]
                [/filter]
            [/not]

            [not]
                [filter_adjacent_location]
                    [filter]
                    [/filter]
                [/filter_adjacent_location]
            [/not]
        ) (
            side=5 # side of reinforcements
            generate_name=yes
            random_traits=yes
        )}
        [redraw][/redraw]
        [delay]
            time=345
        [/delay]
        [unlock_view][/unlock_view]
        [for]
            start=1
            end=32
            [do]
                [scroll_to]
                    x=$i
                    y=32
                [/scroll_to]
                {IF_NOT_HAVE_CREATE_LOYAL 5 (Akladian Warrior) $i 32}
                [delay]
                    time=1
                [/delay]
                [redraw][/redraw]
            [/do]
        [/for]
        [scroll_to_unit]
            id=Gawen Hagarthen
        [/scroll_to_unit]
        {MSGm_Gawen _"All is lost! Enemy reinforcements have arrived! We have no chance to win now!"}
        #po: reference to the event where King Buffin's vanguard starts appearing:
        {MSG_Deorien _"Wait... the last time enemy reinforcements arrived..."}
        {MSGm_Lorin _"No, Gawen is correct! There are too many of them now!"}
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
    [event]
        {MOVETO (1-32) 1 (Gawen Hagarthen)}
        # TODO: some sort of special dialogue for taking the "moveto" path to victory
        [endlevel]
            result=victory
            bonus=yes
        [/endlevel]
    [/event]

    [event]
        name=victory
        {CLEAR_VARIABLE ano_first_time}
        {MSGm_Gawen _"We've won! What should we do now?"}
        {MSGm_Lorin _"We march straight on to Vattin! Boy, I really feel hungry now. This fight has made me STARVING."}
        {MSG_Deorien _"I think, my king, we should go to Freetown, so the Wesnothian rebels from Vakladia can see you and acknowledge you as king. We must hurry, because king Buffin is right behind us."}
        {MSGm_Lorin _"Nonono, not to Freetown! There is nothing worth seeing in Freetown!"}
        {MSGm_Gawen _"Yes, there is definitely something worth seeing in that city. In fact, I can't wait to see her."}
        {MSGm_Lorin _"Her?"}
        {MSGm_Gawen _"Mother, I'll explain later. Let's go!"}

        # PREPARATION FOR THE NEXT SCENARIO
        {IF ano_reumario equals tortured_and_left}
        {NEXT_SCENARIO_VICTORY 23a_Trapped}
        {ELSE_IF ano_reumario equals tortured_and_killed}
        {NEXT_SCENARIO_VICTORY 23b_Trapped}
        {ELSE_IF ano_reumario equals left}
        {NEXT_SCENARIO_VICTORY 23c_Trapped}
        {ELSE}
        {NEXT_SCENARIO_VICTORY 23d_Trapped}
        {TWO_END_IFs}
        {END_IF}
        # FIXME: "<Lua> Repeated [endlevel] execution, ignoring"
    [/event]

    [event]
        name={ON_DIFFICULTY4 (turn 11) (turn 10) (turn 9) (turn 8)}
        [unit]
            side=5
            type=Akladian Raider
            x=26
            y=31
            passable=yes
        [/unit]
        [unit]
            side=5
            type=Akladian Sturmknight
            x=25
            y=32
            passable=yes
        [/unit]
        [unit]
            side=5
            type=Akladian Darknite
            x=27
            y=32
            passable=yes
        [/unit]
        [unit]
            side=5
            type=Akladian Darknite
            x=24
            y=32
            passable=yes
        [/unit]
        #po: this string is both the usual "time over" message, and a fakeout here in S22:
        {MSG_Deorien _"All is lost! Enemy reinforcements have arrived! We have no chance to win now!"}
        [scroll_to]
            x,y=27,30
        [/scroll_to]
        [redraw]
        [/redraw]
        [delay]
            time=500
        [/delay]
        {MSGm_Lorin _"Gee, don't panic. That's only the vanguard of King Buffin's army. I assure you that we still have every opportunity to win."}
    [/event]

    [event]
        name={ON_DIFFICULTY4 (turn 12) (turn 11) (turn 10) (turn 9)}

        [unit]
            side=5
            type=Akladian Darknite
            x=22
            y=32
            passable=yes
        [/unit]
        [unit]
            side=5
            type=Akladian Pikeneer
            x=26
            y=32
            passable=yes
        [/unit]
    [/event]
#ifdef NIGHTMARE
    [event]
        name=turn 11,turn 12 # (turn 12 is the last one on this difficulty)
        first_time_only=no
        [unit]
            side=5
            type=Akladian Darknite
            x,y=22,32
            goto_x,goto_y=25,1
            facing=n
            animate=yes
            passable=yes
        [/unit]
        {IF_NOT_HAVE_CREATE_LOYAL 5 (Akladian Clansman) 23 32}
        {IF_NOT_HAVE_CREATE_LOYAL 5 (Akladian Clansman) 24 32}
        {IF_NOT_HAVE_CREATE_LOYAL 5 (Akladian Clansman) 25 32}
        [unit]
            side=5
            type=Akladian Pikeneer
            x,y=26,32
            goto_x,goto_y=25,1
            facing=n
            animate=yes
            passable=yes
        [/unit]
    [/event]
#endif
    [event]
        name=reload to avoid losses
        {IF ano_first_time equals true}
        {GLOBAL_VARIABLE_TO_LOCAL bride_lastkilled_id tmp}
        {MSGm_Gawen _"I have strange feeling of dejavu... Hey, $tmp, take care of yourself, would you? "}
        {VARIABLE ano_first_time false}
        {END_IF_WITHOUT_ELSE}
    [/event]

    {ALL_ANO_DEATHS}
    {ELVISH_DEATHS}
    {MAGE_DEATHS}
    {ELVISH_KILLING}
[/scenario]
