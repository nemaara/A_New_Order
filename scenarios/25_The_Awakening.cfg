#textdomain wesnoth-A_New_Order
[scenario]
    name = _ "The Awakening"
    id=25_The_Awakening
    map_data="{~add-ons/A_New_Order/maps/WayToVattin.map}"
    next_scenario=26_Return_of_the_King
    {INTRO_AND_SCENARIO_MUSIC siege_of_laurelmor.ogg the_city_falls.ogg}
    {EXTRA_SCENARIO_MUSIC northern_mountains.ogg}
    {EXTRA_SCENARIO_MUSIC siege_of_laurelmor.ogg}
    {EXTRA_SCENARIO_MUSIC battle/onethousandsuns.ogg}
    {EXTRA_SCENARIO_MUSIC weight_of_revenge.ogg}
    {EXTRA_SCENARIO_MUSIC northerners.ogg}
    {EXTRA_SCENARIO_MUSIC theme_of_a_new_order.ogg}
    {EXTRA_SCENARIO_MUSIC battle/ambuscade.ogg}
    {EXTRA_SCENARIO_MUSIC vengeful.ogg}
    {TURNS4 32 30 28 26}

#define BARURIEN
    {IF ano_urien not_equals dead}
    {MESSAGE (Bar Urien) () (_"Bar Urien") _"My Lord! My lord is dead!"}
    {MSGa_Gawen _"Well, noble lord, do you think I have proved myself worthy to be your king?"}
    {MESSAGE (Bar Urien) () (_"Bar Urien") _"Yes, you have."}
    {MSGOPTI2 (Gawen Hagarthen) (portraits/gawen_matured.png) (_"Well...")
    (_"Then will you stop fighting and join us?") (join)
    (_"It's a shame, then, that I have to kill you.") (kill)
    }

    {IF ano_opt equals join}
    {MESSAGE (Bar Urien) () (_"Bar Urien") _"I would be honoured to fight at your side, my king."}
    [modify_side]
        side=5
        team_name=good
    [/modify_side]
    {END_IF_WITHOUT_ELSE}
    {END_IF_WITHOUT_ELSE}

#enddef

#define PEASANT_REBEL_TALK F PEASANT_NAME
    {IF ({F}) equals friend}
    {MESSAGE ({PEASANT_NAME}) () ({PEASANT_NAME}) _"Long live our king Gawen Haldric! It will be honour to fight for you, my king!"}
    {ELSE}
    {MESSAGE ({PEASANT_NAME}) () ({PEASANT_NAME}) _"Death to enemies of our king! Long live our king Gawen Haldric!"}
    {END_IF}
#enddef

#define PEASANT_REBEL X Y FRIEND_OR_FOE PEASANT_NAME PEASANT_ID
    {FORMAT ano_tmp (ano_villages.v{X}|_{Y})}
    {IF ($ano_tmp) not_equals (1)}
    {CLEAR_VARIABLE ano_tmp}
    {FORMAT ano_tmp ($x1|$y1)}
    {RANDOM 1..100}
    # To consider: maybe having the probability here vary with difficulty?
    {IF random less_than 50}
    {VARIABLE orig_random $random}
    {RANDOM 1..6}
    {VARIABLE peasant_id "{PEASANT_ID}"}
    {IF random equals 1}
    [unit]
        type=Peasant
        id=$peasant_id
        name={PEASANT_NAME}
        side=1
        x=$x1
        y=$y1
        animate=yes
        [modifications]
            {TRAIT_LOYAL}
            {TRAIT_STRONG}
            {TRAIT_RESILIENT}
        [/modifications]
    [/unit]
#ifdef EASY
    [gold]
        side=1
        amount=1
    [/gold]
    [floating_text]
        x,y=$x1,$y1
        #wmllint: markcheck off
        text="<span color='#BCB088'>+1g</span>"
        #wmllint: markcheck on
    [/floating_text]
#endif
    {ELSE_IF random equals 2}
    [unit]
        type=Peasant
        id=$peasant_id
        name={PEASANT_NAME}
        side=1
        x=$x1
        y=$y1
        animate=yes
        [modifications]
            {TRAIT_LOYAL}
            {TRAIT_QUICK}
            {TRAIT_INTELLIGENT}
        [/modifications]
    [/unit]
    [gold]
        side=1
        amount={ON_DIFFICULTY4 2 1 0 0}
    [/gold]
    [floating_text]
        x,y=$x1,$y1
        #wmllint: markcheck off
#ifdef EASY
        text="<span color='#BCB088'>+2g</span>"
#else
#ifdef NORMAL
        text="<span color='#BCB088'>+1g</span>"
#else
        text="..."
#endif
#endif
        #wmllint: markcheck on
    [/floating_text]
    {ELSE_IF random equals 3}
    [unit]
        type=Peasant
        id=$peasant_id
        name={PEASANT_NAME}
        side=1
        x=$x1
        y=$y1
        animate=yes
        [modifications]
            {TRAIT_LOYAL}
            {TRAIT_QUICK}
            {TRAIT_RESILIENT}
        [/modifications]
    [/unit]
#ifdef NIGHTMARE
    [redraw][/redraw]
#else
    [gold]
        side=1
        amount={ON_DIFFICULTY4 3 2 1 0}
    [/gold]
    [floating_text]
        x,y=$x1,$y1
        #wmllint: markcheck off
        text="<span color='#BCB088'>+{ON_DIFFICULTY4 3 2 1 0}g</span>"
        #wmllint: markcheck on
    [/floating_text]
#endif
    {ELSE_IF random equals 4}
    [unit]
        type=Peasant
        id=$peasant_id
        name={PEASANT_NAME}
        side=1
        x=$x1
        y=$y1
        animate=yes
        [modifications]
            {TRAIT_LOYAL}
            {TRAIT_QUICK}
            {TRAIT_STRONG}
        [/modifications]
    [/unit]
    [gold]
        side=1
        amount={ON_DIFFICULTY4 4 3 2 1}
    [/gold]
    [floating_text]
        x,y=$x1,$y1
        #wmllint: markcheck off
        text="<span color='#BCB088'>+{ON_DIFFICULTY4 4 3 2 1}g</span>"
        #wmllint: markcheck on
    [/floating_text]
    {ELSE_IF random equals 5}
    [unit]
        type=Peasant
        id=$peasant_id
        name={PEASANT_NAME}
        side=1
        x=$x1
        y=$y1
        animate=yes
        [modifications]
            {TRAIT_LOYAL}
            {TRAIT_INTELLIGENT}
            {TRAIT_STRONG}
        [/modifications]
    [/unit]
    [gold]
        side=1
        amount={ON_DIFFICULTY4 5 4 3 2}
    [/gold]
    [floating_text]
        x,y=$x1,$y1
        #wmllint: markcheck off
        text="<span color='#BCB088'>+{ON_DIFFICULTY4 5 4 3 2}g</span>"
        #wmllint: markcheck on
    [/floating_text]
    {ELSE}
    [unit]
        type=Peasant
        id=$peasant_id
        name={PEASANT_NAME}
        side=1
        x=$x1
        y=$y1
        animate=yes
        [modifications]
            {TRAIT_LOYAL}
            {TRAIT_INTELLIGENT}
            {TRAIT_RESILIENT}
        [/modifications]
    [/unit]
    [gold]
        side=1
        amount={ON_DIFFICULTY4 6 5 4 3}
    [/gold]
    [floating_text]
        x,y=$x1,$y1
        #wmllint: markcheck off
        text="<span color='#BCB088'>+{ON_DIFFICULTY4 6 5 4 3}g</span>"
        #wmllint: markcheck on
    [/floating_text]
    {FOUR_END_IFs}
    {CLEAR_VARIABLE ano_tmp_unit}
    [store_unit]
        [filter]
            x={X}
            y={Y}
        [/filter]
        variable=ano_tmp_unit
    [/store_unit]
    {END_IF}

    [scroll_to_unit]
        id=$peasant_id
    [/scroll_to_unit]
    [delay]
        time="$(max(1001, (($random + $orig_random + {ON_DIFFICULTY4 6 4 2 1}) * 12)))"
#ifdef DEBUG_MODE
        accelerate=yes
#endif
    [/delay]
    [redraw][/redraw]
    {PEASANT_REBEL_TALK ({FRIEND_OR_FOE}) $peasant_id}

    {ELSE}
#ifdef DEBUG_MODE
    {IF_DEBUG_MODE_IS_ACTUALLY_ON}
    {DEBUGMSG1 "Unhandled value: $random|."}
    {END_IF_WITHOUT_ELSE}
#endif
    {END_IF}
    [set_variable]
        name=ano_villages.v{X}|_{Y}
        value=1
    [/set_variable]
    {CLEAR_VARIABLE orig_random}
    {ELSE}
#ifdef DEBUG_MODE
    {IF_DEBUG_MODE_IS_ACTUALLY_ON}
    {IF random not_equals 0}
    {DEBUGMSG1 "Nothing at $ano_tmp|; roll was $random|."}
    {ELSE}
    {DEBUGMSG1 "Nothing here: ano_tmp: $ano_tmp|."}
    {END_IF}
    {END_IF_WITHOUT_ELSE}
#endif
    {END_IF}
#enddef

#define AKLADIAN_PEASANT_REBEL_FRIEND CLANSMAN_NAME CLANSMAN_ID
    {VARIABLE clansman_id {CLANSMAN_ID}}
    {VARIABLE clansman_name {CLANSMAN_NAME}}

    [unit]
        type=Akladian Clansman
        id=$clansman_id
        name=$clansman_name
        side=1
        x=$x1
        y=$y1
        animate=yes
        [modifications]
            {TRAIT_LOYAL}
            {TRAIT_STRONG}
            {TRAIT_RESILIENT}
        [/modifications]
    [/unit]
    {MESSAGE ({CLANSMAN_ID}) () ({CLANSMAN_ID}) _"Long live our king Gawen Haldric! It will be honour to fight for you, my king!"}
#enddef

    [story]
        [part]
            #po: spoken by the Oracle (woman)
            story=_"People of Vakladia! People of Wesnoth! Long have ye waited for a messiah to come. Long have ye waited for a new king to unite the nation and to end the wars plaguing our country. The orcs ravage unopposed through the land, murdering and raping Akladians and Wesnothians alike, invited here by traitors whose souls are cankered with a lust for power and whose eyes have been blinded by callous hatred."
            background=story_images/people_of_vakladia.png
        [/part]
        [part]
            story=_"Ye have heard the stories about undead invading the neighbouring kingdom of Okladia. Some lost all hope. But be ye not afraid, for there is a man who is sent here to stop the undead menace and to cleanse the evil festering within the very heart of our country. "
            background=story_images/people_of_vakladia.png
        [/part]
        [part]
            story=_"Ye have all heard about him. Son of an Akladian king and a Wesnothian queen. A great warrior and great leader. Let him know ye wish him to come here and take his crown. All hail the king! All hail the messiah! All hail Gawen Haldric Hagarthen!"
        [/part]
    [/story]

    {DAWN}
    {MORNING}
    {AFTERNOON}
    {DUSK}
    {FIRST_WATCH}
    {SECOND_WATCH}

    victory_when_enemies_defeated=yes
    # enemies:
    {STARTING_VILLAGES 3 {ON_DIFFICULTY4 6 7 8 9}}
    {STARTING_VILLAGES 4 {ON_DIFFICULTY4 6 7 8 9}}
    {STARTING_VILLAGES 5 {ON_DIFFICULTY4 6 7 8 9}}
    # (there is no side 6)
    # allies:
    {STARTING_VILLAGES 2 {ON_DIFFICULTY4 10 9 8 7}}

    {PLACE_IMAGE (items/orcish-flag.png) 6 19}
    {PLACE_IMAGE (items/orcish-flag.png) 3 17}
    [side]
        controller=human
        id=Gawen Hagarthen
        name=_"Gawen Hagarthen"
        type=Hagarthen
        profile=portraits/gawen_was.png
        team_name=good
        canrecruit=yes
        unrenamable=yes
        side=1
        facing=se
        # list here explicitly the bare minimum recruits list player will have after previous scenario;
        # any additional recruits will still be added to it:
        recruit=Peasant,Fencer,Spearman,Bowman,Akladian Clansman,Akladian Wiseman,Akladian Homeguard,Akladian Warrior
        {GOLD4 260 220 180 140}
        {INCOME4 6 5 4 3}
    [/side]

    {BUFF_AKLADIAN_HEALERS}

    [side]
        controller=ai
        id=Huon Ryedric
        save_id=Huon Ryedric
        persistent=yes
        name=_"Huon Ryedric"
        type=General
        profile=portraits/huon.png
        team_name=good
        canrecruit=yes
        side=2
        facing=ne
        # Spearman = fighter, Javelineer = fighter, Bowman = archer, Peasant = fighter, Swordsman = fighter, Mage = mixed fighter, White Mage = healer
        recruit=Spearman,Javelineer,Bowman,Peasant,Swordsman,Mage,White Mage
        {INCOME4 9 7 5 3}
        {GOLD4 250 220 190 160}
        [ai]
            {NO_SCOUTS}
            passive_leader=no
            recruitment_pattern=fighter,fighter,healer,fighter,archer,mixed fighter
            caution=0.25
            aggression=0.5
            grouping=defensive
            leader_aggression={ON_DIFFICULTY4 -6 -5 -4 -3}
            [goal]
                name=protect_unit
                [criteria]
                    id=Huon Ryedric
                [/criteria]
                protect_radius=6 # MP of a general
                value=50
            [/goal]
            [goal]
                [criteria]
                    id=Hoyre O Barnone
                [/criteria]
                value=40
            [/goal]
            [goal]
                [criteria]
                    id=Bar Urien
                [/criteria]
                value=30
            [/goal]
            [goal]
                [criteria]
                    id=Barhoon Urk
                [/criteria]
                value=20
            [/goal]
            [goal]
                name=protect_unit
                [criteria]
                    id=Gawen Hagarthen
                [/criteria]
                protect_radius=6 # his max MP (without taking AMLAs or anything into account)
                value=10
            [/goal]
        [/ai]
        [ai]
            time_of_day=dusk,first_watch,second_watch
            aggression=0.2
            caution=0.8
            grouping=no
            leader_aggression={ON_DIFFICULTY4 -8 -7 -6 -5}
        [/ai]
    [/side]

    # The AI_CONTROLLER macro may be getting deprecated in mainline, but I personally still like it,
    # and sometimes Huon needs help, so we have a local copy prefixed with "ANO_" for this campaign:
    {ANO_AI_CONTROLLER () 1 2 ()}

    [side]
        controller=ai
        id=Barhoon Urk
        name=_"Barhoon Urk"
        type=Orcish Warlord
        team_name=bad
        canrecruit=yes
        side=3
        facing=se # (could also be "ne")
        # Warrior = fighter, Wolf Rider = scout, Archer = archer, Assassin = mixed fighter, Slayer = mixed fighter, Troll = fighter, Shaman = mixed fighter
        recruit=Orcish Warrior,Wolf Rider,Orcish Archer,Orcish Assassin,Orcish Slayer,Troll,Orcish Shaman
        {GOLD4 200 215 230 245}
        {INCOME4 4 5 6 7}
        [ai]
            recruitment_pattern=fighter,mixed fighter,fighter,mixed fighter,fighter,1,scout
            caution=0.5
            aggression=0.2
            grouping=offensive
            [goal]
                name=protect_unit
                [criteria] #NOTE: this is a SUF, because we're protecting a unit
                    id=Barhoon Urk
                [/criteria]
                protect_radius={ON_DIFFICULTY4 6 7 8 9}
                value=50
            [/goal]
            [goal]
                [criteria] #NOTE: this is a SUF, because we're targeting a unit
                    id=Huon Ryedric
                [/criteria]
                value=25
            [/goal]
            [goal]
                [criteria]
                    side=2
                [/criteria]
                value={ON_DIFFICULTY4 7 8 9 10}
            [/goal]
        [/ai]
        [ai]
            time_of_day=dusk,first_watch,second_watch
            aggression={ON_DIFFICULTY4 0.7 0.8 0.9 1.0}
            caution={ON_DIFFICULTY4 0.21 0.14 0.07 0.00}
            grouping=no
        [/ai]
    [/side]

    [side]
        controller=ai
        id=Hoyre O Barnone
        name=_"Hoyre O Barnone"
        type=Akladian Lord
        profile=portraits/hoyre.png
        team_name=bad
        canrecruit=yes
        side=4
        facing=nw
#ifdef EASY
        recruit=Akladian Wonderman,Akladian Warrior,Akladian Light Infantry,Akladian Darknite,Akladian Sturmknight,Akladian Raider
#else
        recruit=Akladian Wonderman,Akladian Pikeneer,Akladian Warrior,Akladian Light Infantry,Akladian Darknite,Akladian Sturmknight,Akladian Raider,Akladian Fastfoot
#endif
        {GOLD4 260 300 340 380}
        {INCOME4 8 10 12 14}
        [ai]
            recruitment_pattern=fighter,1,fighter,healer,fighter
#ifdef EASY
            [goal]
                [criteria] #NOTE: this is a SUF, because we're targeting a unit
                    id=Gawen Hagarthen
                [/criteria]
                value=75
            [/goal]
            [goal]
                name=protect_unit
                [criteria] #NOTE: this is a SUF, because we're protecting a unit
                    id=Hoyre O Barnone
                [/criteria]
                protect_radius=6
                value=50
            [/goal]
            [goal]
                name=protect_location
                [criteria]
                    x,y=23,28 # Hoyre's keep
                [/criteria]
                protect_radius=5
                value=40
            [/goal]
            [goal]
                name=protect_location
                [criteria]
                    x,y=18,14 # Bar Urien's keep
                [/criteria]
                protect_radius=4
                value=30
            [/goal]
            [goal]
                [criteria] #NOTE: this is a SUF, because we're targeting a unit
                    id=Huon Ryedric
                [/criteria]
                value=20
            [/goal]
            # (skip targeting side 2 as a whole, though, as that makes it too hard to save Huon)
#else
            [goal]
                [criteria] #NOTE: this is a SUF, because we're targeting a unit
                    id=Gawen Hagarthen
                [/criteria]
                value=100
            [/goal]
            [goal]
                [criteria] #NOTE: this is a SUF, because we're targeting a unit
                    id=Lady Lorin
                [/criteria]
                value=100
            [/goal]
            [goal]
                [criteria] #NOTE: this is a SUF, because we're targeting a unit
                    id=Ruvio
                [/criteria]
                value=100
            [/goal]
#endif
        [/ai]
        [ai]
            time_of_day=dawn,morning,afternoon
            caution=0.3
            aggression=0.6
            grouping=offensive
        [/ai]
        [ai]
            time_of_day=dusk,first_watch,second_watch
            caution={ON_DIFFICULTY4 0.21 0.14 0.07 0.00}
            aggression={ON_DIFFICULTY4 0.7 0.8 0.9 1.0}
            grouping=no
        [/ai]
    [/side]

    [side]
        controller=ai
        id=Bar Urien
        name=_"Bar Urien"
        type=Akladian Lord
        team_name=bad
        canrecruit=yes
        side=5
        facing=se # (could also be just "s")
#ifdef EASY
        recruit=Akladian Wonderman,Akladian Warrior,Akladian Light Infantry,Akladian Sturmknight,Akladian Raider
#else
        recruit=Akladian Wonderman,Akladian Pikeneer,Akladian Warrior,Akladian Light Infantry,Akladian Darknite,Akladian Sturmknight,Akladian Raider
#endif
        {GOLD4 200 225 250 275}
        {INCOME4 4 6 8 10}
        [ai]
            recruitment_pattern=fighter,1,fighter,healer,fighter
#ifdef EASY
            [goal]
                [criteria] #NOTE: this is a SUF, because we're targeting a unit
                    id=Gawen Hagarthen
                [/criteria]
                value=75
            [/goal]
            [goal]
                name=protect_unit
                [criteria] #NOTE: this is a SUF, because we're protecting a unit
                    id=Bar Urien
                [/criteria]
                protect_radius=6
                value=50
            [/goal]
            [goal]
                [criteria] #NOTE: this is a SUF, because we're targeting a unit
                    id=Huon Ryedric
                [/criteria]
                value=25
            [/goal]
            [goal]
                [criteria]
                    side=2
                [/criteria]
                value=10
            [/goal]
#else
            [goal]
                [criteria] #NOTE: this is a SUF, because we're targeting a unit
                    id=Gawen Hagarthen
                [/criteria]
                value=100
            [/goal]
            [goal]
                [criteria] #NOTE: this is a SUF, because we're targeting a unit
                    id=Lady Lorin
                [/criteria]
                value=100
            [/goal]
            [goal]
                [criteria] #NOTE: this is a SUF, because we're targeting a unit
                    id=Ruvio
                [/criteria]
                value=100
            [/goal]
#endif
        [/ai]
        [ai]
            time_of_day=dawn,morning,afternoon
            caution=0.3
            aggression=0.6
            grouping=offensive
        [/ai]
        [ai]
            time_of_day=dusk,first_watch,second_watch
            caution={ON_DIFFICULTY4 0.21 0.14 0.07 0.00}
            aggression={ON_DIFFICULTY4 0.7 0.8 0.9 1.0}
            grouping=no
        [/ai]
    [/side]

    [event]
        name=prestart
        {RECALLXY (Ruvio) 10 2}
        {RECALLXY (Lady Lorin) 11 2}
        {IF_HAVE_UNIT_ANY (Reme Carrenemoe)}
        {RECALLXY (Reme Carrenemoe) 12 2}
        {ELSE}
#ifdef NIGHTMARE
        [terrain]
            x,y=12,2
            layer=overlay
            terrain="^Edb"
        [/terrain]
#else
        {GENERIC_UNIT 1 (Peasant) 12 2}
#endif
        {END_IF}
        {RECALLXY (Deorien) 11 4}
#ifdef EASY
        {GENERIC_UNIT 1 (Bowman) 10 3}
        {IF_NOT_HAVE_CREATE_LOYAL 1 (Bowman) 10 3}
        {GENERIC_UNIT 1 (Spearman) 12 3}
        {IF_NOT_HAVE_CREATE_LOYAL 1 (Spearman) 12 3}
        # For Huon:
        [terrain]
            x,y=7,31
            terrain=Hh^Vct
        [/terrain]
        [capture_village]
            x,y=7,31
            side=2
        [/capture_village]
#endif
#ifdef NORMAL
        # Slightly weaker:
        {IF_NOT_HAVE_CREATE_LOYAL 1 (Peasant) 10 3}
        {IF_NOT_HAVE_CREATE_LOYAL 1 (Peasant) 12 3}
#endif # NORMAL
        [modify_unit]
            [filter]
                side=1
            [/filter]
            facing=s
        [/modify_unit]

        # Replacement for attack_depth being removed:
        [micro_ai]
            side=3
            ai_type=wolves_multipacks
            action=add
            type=Wolf Rider

#ifdef DEBUG_MODE
            show_pack_number=yes
#endif
            pack_size={ON_DIFFICULTY4 1 2 3 4}
        [/micro_ai]

        {VARIABLE ano_side_two 1}
        {VARIABLE orig_random 0}
        {RANDOM 1..100}
        {CLEAR_VARIABLE vojta}
        {CLEAR_VARIABLE kuba}
        {CLEAR_VARIABLE matej}
        {VARIABLE_OP vojta add 1}
        {VARIABLE_OP kuba add 1}
        {VARIABLE_OP matej add 1}
    [/event]

    [event]
        name=start
        {MSG_Hoyre _"Is there any news from Bor Cryne?"}
        {MESSAGE (Bar Urien) () (_"Bar Urien") _"Nothing new, my lord."}
        {MSG_Hoyre _"He should already be here! Where is he?"}
        {MESSAGE (Bar Urien) () (_"Bar Urien") _"My lord... This man, they call a messiah..."}
        {MSG_Hoyre _"This underling? A creature who has usurped the holy name and who will be punished by God!"}
        {MESSAGE (Bar Urien) () (_"Bar Urien") _"But... What about if he really IS a messiah?"}
        {MSG_Hoyre _"There is no question about it. Believe me, Bar Urien, I have been hearing the voices of the spirits since my youth and God has sent me many messages. Gawen is not the messiah. He is a mixling, one who is unworthy of even honourable death."}
        {MESSAGE (Bar Urien) () (_"Bar Urien") _"But, I thought, let's just assume for a moment he IS..."}
        {MSG_Hoyre _"Bar, you are fine warrior and you have always served our clan loyally. But leave the thinking to me."}
        {MESSAGE (Bar Urien) () (_"Bar Urien") _"But the Oracle..."}
        {MSG_Hoyre _"There is no 'but'. I have long suspected the Oracle is tool of the evil, not of God."}
        {MESSAGE (Barhoon Urk) () (_"Barhoon Urk") _"I don't want to interrupt you your interesting discussion, but <i><u>I</u></i> think you will have chance to ask this Gawen directly about everything."}
        {MSGm_Gawen _"Akladians - open the way for me and my army. I am your rightful king, I am the messiah, the hand of God on earth. Whoever opposes me opposes God."}
        {MSG_Hoyre _"Cease this blasphemy, foul mixling! You are nothing but a flabby underling."}
        {IF ano_hoyre_run equals yes}
        {MSGm_Gawen _"Have you already forgotten that you have fled from me before, revered Hoyre? Twice now you have faced me; this time there will be no escape. You will lie dead on the battlefield, unless you recognise me as your king."}
        {ELSE}
        {MSGm_Gawen _"I am your king, Hoyre. Admit that or I will be forced to kill you."}
        {END_IF}
        {MSG_Hoyre _"My king? You, my king? Never! I will rip your heart out! I will cut your hands off and feed the crows with them!"}
        {MESSAGE (Bar Urien) () (_"Bar Urien") _"My lord, Bor Cryne not be far from here. It isn't wise to fight alone against the rebels' army."}
        {MSGm_Gawen _"What about you, noble lord? Will you oppose your king and messiah as declared by the Oracle?"}
        {MESSAGE (Bar Urien) () (_"Bar Urien") _"I don't know what to think. But there IS one way to determine whether you are really what you claim to be... whether you are able to defeat us."}
        {MSGm_Lorin _"By the way, Gawen, you are really starting to become convincing in your role. You seem to like it, despite your earlier protests."}
        {MSG_Huon _"Enough talk. We must slay our enemies. To arms!"}
        {MSGm_Lorin _"Yes, to arms! To think, I am actually agreeing with an underling!"}

        [objectives]
            side=1
            [objective]
                description=_"Kill all enemy leaders"
                condition=win
            [/objective]
            [objective]
                description=_"Death of Gawen Hagarthen"
                condition=lose
            [/objective]
            [objective]
                description=_"Death of Ruvio"
                condition=lose
            [/objective]
            [objective]
                description=_"Death of Lady Lorin"
                condition=lose
            [/objective]
            [objective]
                description=_"Death of Deorien"
                condition=lose
            [/objective]
            [objective]
                description=_"Death of Huon Ryedric"
                condition=lose
            [/objective]
            {TURNS_RUN_OUT}
            {ANO_AI_CONTROLLER_NOTE}
            {OBJECTIVE_NOTES _"Some peasants may have gold to give you in this scenario when you visit their villages."}
        [/objectives]
    [/event]

    [event]
        name=time over
        [scroll_to]
            x,y=3,21 # Barhoon Urk's keep
        [/scroll_to]
        [lock_view][/lock_view]
        {SCATTER_UNITS 20 "Orcish Shaman,Orcish Slurbow,Orcish Warlord,Direwolf Rider" 1 (
            x=1-9
            y=12-25

            [not]
                terrain=Ww
            [/not]

            [not]
                [filter]
                [/filter]
            [/not]

            [not]
                [filter_adjacent_location]
                    [filter]
                    [/filter]
                [/filter_adjacent_location]
            [/not]
        ) (
            side=3 # Barhoon Urk (orcs)
            generate_name=yes
            random_traits=yes
        )}
        [redraw][/redraw]
        [delay]
            time=345
        [/delay]
        [unlock_view][/unlock_view]
        [scroll_to]
            x,y=23,28 # Hoyre's keep
        [/scroll_to]
        [lock_view][/lock_view]
        {SCATTER_UNITS 30 "Akladian Protector,Akladian Darknite,Akladian Fastfoot,Akladian Pikeneer" 2 (
            x=12-27
            y=22-35

            [not]
                terrain=Ww
            [/not]

            [not]
                [filter]
                [/filter]
            [/not]

            [not]
                [filter_adjacent_location]
                    [filter]
                    [/filter]
                [/filter_adjacent_location]
            [/not]
        ) (
            side=4 # Hoyre
            generate_name=yes
            random_traits=yes
        )}
        [redraw][/redraw]
        [delay]
            time=345
        [/delay]
        [unlock_view][/unlock_view]
        [scroll_to]
            x,y=18,14 # Bar Urien's keep
        [/scroll_to]
        [lock_view][/lock_view]
        {SCATTER_UNITS 30 "Akladian Protector,Akladian Darknite,Akladian Fastfoot,Akladian Pikeneer" 3 (
            x=10-27
            y=10-21

            [not]
                terrain=Ww
            [/not]

            [not]
                [filter]
                [/filter]
            [/not]

            [not]
                [filter_adjacent_location]
                    [filter]
                    [/filter]
                [/filter_adjacent_location]
            [/not]
        ) (
            side=5 # Bar Urien
            generate_name=yes
            random_traits=yes
        )}
        [redraw][/redraw]
        [delay]
            time=345
        [/delay]
        [unlock_view][/unlock_view]
        [scroll_to_unit]
            id=Ruvio
        [/scroll_to_unit]
        {MSGm_Ruvio _"All is lost! Enemy reinforcements have arrived! We have no chance to win now!"}
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=victory
        {CLEAR_VARIABLE ano_side_two}
        {CLEAR_VARIABLE ano_urien}
        [move_unit_fake]
            side=5
            x=27,26
            y=34,33
            type=Akladian Lord
        [/move_unit_fake]
        [unit]
            type=Lord Bor Cryne
            id=Bor Cryne
            name=_"Bor Cryne"
            x=25
            y=33
            side=5
            {ANO_ENEMY_LEADER_TRAITS}
        [/unit]
        [move_unit_fake]
            side=5
            x=27,26
            y=34,33
            type=Akladian Sturmknight
        [/move_unit_fake]
        [unit]
            type=Akladian Sturmknight
            id=Bors Brien
            name=_"Bors Brien"
            x=26
            y=32
            side=5
        [/unit]
        [move_unit_fake]
            side=5
            x=27
            y=34
            type=Akladian Darknite
        [/move_unit_fake]
        [unit]
            type=Akladian Darknite
            id=Bors Dark
            name=_"Bors Dark"
            x=26
            y=33
            side=5
        [/unit]
        [unit]
            type=Akladian Wonderman
            id=Bors Wonder
            name=_"Bors Wonder"
            x=27
            y=34
            side=5
        [/unit]
        {MSG_Cryne _"Curses! We are too late."}
        {MESSAGE (Bors Brien) () (_"Bors Brien") _"Should we attack, my lord?"}
        {MSG_Cryne _"No. As usual, Hoyre screwed up everything he possibly could. We will withdraw to the north, and wait until Grekulak arrives to help us."}

        {CLEAR_VARIABLE ano_villages}
        {MSG_Deorien _"My king, I've heard that some of people of Wesnoth have started to take revenge on their own. A few Akladian villages were massacred south of Freetown. What will you do?"}
        {MSG_Huon _"And what do you think he could do? People want revenge, so..."}
        {MSGm_Ruvio _"Revenge on whom? On innocent woman and children?"}
        {MSG_Huon _"Innocent? No Akladian is innocent! Even if they didn't participate in the massacres, maybe their husbands or uncles did, and..."}
        {MSGm_Ruvio _"How many Wesnothians have been brought back from the dead by the killing of Akladian children, Huon? I lost whole family in Freetown. But I don't want to avenge them by killing families of innocent people. It will not bring them back."}
        {MSG_Deorien _"You have to react, my king. If you won't stop this, Akladians with turn away from you and there will be another round of civil war."}
        {MSG_Huon _"Punish them? Why? They acted out of despair and anger, they lost their whole families at the hands of Akladians, how can you punish them? If you do, a lot of the Wesnothians will turn away from you..."}
        {MSGm_Gawen _"I now declare amnesty for everyone. But from this moment forward, anyone who wants to spill innocent blood will be hunted by me and my people. People who have already committed crimes should go make a pilgrimage to the Oracle to ask for forgiveness."}
        {MSGm_Lorin _"THIS is supposed to be a punishment? Akladians won't like it."}
        {MSGm_Gawen _"I am the messiah. Any Akladians who would contest my words are tools of evil and will never be admitted to the land of their ancestors."}
        {MSG_Huon _"Messiah? You do not actually believe that!?"}
        {MSGm_Gawen _"Huon, the proper way to address your king is 'your majesty' - or at the least 'my king'. Deorien was right all the time, now I see it clearly. Akladians might rebel against their king and they might definitely rebel against a king of mixed blood. But they cannot rebel against the hand of God on earth."}
        {MSGm_Gawen _"The way to Vattin is free of enemies. Let's go."}
        {CLEAR_VARIABLE random}
        {CLEAR_VARIABLE orig_random}
    [/event]

    [event]
        name=capture
        first_time_only=no
        [filter]
            side=1
            x,y=1-16,1-9
        [/filter]

        {PEASANT_REBEL ($x1) ($y1) (friend) _"Vojta" "Vojta $vojta"}
        {VARIABLE_OP vojta add 1}
    [/event]
    [event]
        name=capture
        first_time_only=no
        [filter]
            side=1
            x,y=4-15,14-32
        [/filter]
        {PEASANT_REBEL ($x1) ($y1) (foe) _"Kuba" "Kuba $kuba"}
        {VARIABLE_OP kuba add 1}
    [/event]
    [event]
        name=capture
        first_time_only=no
        [filter]
            side=1
            x,y=18-27,12-32
        [/filter]
        {PEASANT_REBEL ($x1) ($y1) (friend) _"Matej" "Matej $matej"}
        {VARIABLE_OP matej add 1}
    [/event]

    [event]
        name=capture
        first_time_only=yes
        [filter]
            side=1
            x,y=21,5
        [/filter]
        {AKLADIAN_PEASANT_REBEL_FRIEND _"Rumpel" Rumpel}
    [/event]
    [event]
        name=capture
        first_time_only=yes
        [filter]
            side=1
            x,y=3,14
        [/filter]
        {AKLADIAN_PEASANT_REBEL_FRIEND _"Cimper" Cimper}
    [/event]
    [event]
        name=capture
        first_time_only=yes
        [filter]
            side=1
            x,y=17,28
        [/filter]
        {AKLADIAN_PEASANT_REBEL_FRIEND _"Camper" Camper}
    [/event]
    [event]
        name=die
        first_time_only=no
        [filter]
            side=2
        [/filter]
        {VARIABLE_OP ano_side_two add 1}
        {IF ano_side_two equals 4}
        {MSG_Huon _"My king, we could really use some help here."}
        [gold]
            side=2
            amount={ON_DIFFICULTY4 30 21 12 3}
        [/gold]
        {ELSE_IF ano_side_two equals 8}
        {MSG_Huon _"We are under heavy assault, my king. We really could use some help here."}
        [gold]
            side=2
            amount={ON_DIFFICULTY4 30 21 12 3}
        [/gold]
        {END_IF_WITHOUT_ELSE}
        {END_IF}
    [/event]

    [event]
        name=attack
        [filter_second]
            id=Huon Ryedric
        [/filter_second]
        {MSG_Huon _"The barbarians attack me! I need help NOW!"}
        [gold]
            side=2
            amount={ON_DIFFICULTY4 60 41 22 3}
        [/gold]
        # encampment:
        {IF_NOT_HAVE_CREATE_LOYAL 2 (Peasant) 4 30}
        {IF_NOT_HAVE_CREATE_LOYAL 2 (Peasant) 4 31}
        {IF_NOT_HAVE_CREATE_LOYAL 2 (Peasant) 5 30}
        {IF_NOT_HAVE_CREATE_LOYAL 2 (Peasant) 5 31}
        {IF_NOT_HAVE_CREATE_LOYAL 2 (Peasant) 5 32}
        {IF_NOT_HAVE_CREATE_LOYAL 2 (Peasant) 6 30}
        {IF_NOT_HAVE_CREATE_LOYAL 2 (Peasant) 6 31}
        # nearby villages:
        {IF_NOT_HAVE_CREATE_LOYAL 2 (Peasant) 3 29}
        {IF_NOT_HAVE_CREATE_LOYAL 2 (Peasant) 2 31}
        {IF_NOT_HAVE_CREATE_LOYAL 2 (Peasant) 5 34}
        {IF_NOT_HAVE_CREATE_LOYAL 2 (Peasant) 8 28}
#ifdef EASY
        {IF_NOT_HAVE_CREATE_LOYAL 2 (Peasant) 7 31} # (only a village on EASY)
#endif
    [/event]

    # This should help prevent Huon from suiciding himself by discouraging him
    # from leaving his castle and surrounding villages
    # (copied from SotBE with modifications)
    [event]
        name=side 2 turn refresh
        first_time_only=no

        [modify_unit]
            [filter]
                side=$side_number
                canrecruit=yes
            [/filter]

            [movement_costs]
                flat={ON_DIFFICULTY4 8 7 6 5}
            [/movement_costs]
        [/modify_unit]

        [event]
            name=side turn end

            [modify_unit]
                [filter]
                    side=$side_number
                    canrecruit=yes
                [/filter]

                [movement_costs]
                    flat=1
                [/movement_costs]
            [/modify_unit]
        [/event]
    [/event]

    [event]
        name=turn 5

        {OPVAL ("Lady Lorin") (hitpoints) (add) (-10)}
        {MSGm_Lorin _"Aaah!"}
        {MSGm_Gawen _"What? Mother, are you hurt?"}
        {MSGm_Lorin _"No... I'm ok... I'm ok... It was nothing."}
        {MSGm_Gawen _"But what that? Are you wounded?"}
        {MSGm_Lorin _"No, Gawen, I've told you I'm OK!"}
        {MSG_Huon _"The witch most likely accidentally drank a poison she was preparing for someone else."}
        {MSG_Deorien _"No, my lord. I think I know what's happening with your step-mother, but if she does not want to tell you, neither will I. But be prepared... she may not be able to fight in some of the battles which await us in future."}
        {MSGm_Lorin _"Underling, be silent. You know nothing. You all know nothing. I will fight."}
    [/event]

    [event]
        name=moveto
        [filter]
            x,y=3,21
            side=1
        [/filter]

        {VARIABLE gold_amt {ON_DIFFICULTY4 70 60 50 40}}
        {MSGm_Gawen _"Ha! They were hiding some gold here!"}
        [gold]
            amount=$gold_amt
            side=1
        [/gold]
        {MSG_narrator _"You have received $gold_amt gold pieces."}
        {CLEAR_VARIABLE gold_amt}
    [/event]
    [event]
        name=moveto
        [filter]
            x,y=18,14
            side=1
        [/filter]

        {VARIABLE gold_amt {ON_DIFFICULTY4 70 60 50 40}}
        {MSGm_Gawen _"Ha! They were hiding some gold here!"}
        [gold]
            amount=$gold_amt
            side=1
        [/gold]
        {MSG_narrator _"You have received $gold_amt gold pieces."}
        {CLEAR_VARIABLE gold_amt}
    [/event]
    [event]
        name=moveto
        [filter]
            x,y=23,28
            side=1
        [/filter]

        {VARIABLE gold_amt {ON_DIFFICULTY4 70 60 50 40}}
        {MSGm_Gawen _"Ha! They were hiding some gold here!"}
        [gold]
            amount=$gold_amt
            side=1
        [/gold]
        {MSG_narrator _"You have received $gold_amt gold pieces."}
        {CLEAR_VARIABLE gold_amt}
    [/event]

    [event]
        name=last breath
        [filter]
            id=Huon Ryedric
            side=2
        [/filter]
        {MSG_Huon _"No! I haven't avenged my family!"}
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        {KILLEDBY (Hoyre O Barnone) (Ruvio)}
        {MSG_Hoyre _"Stop! Don't kill me! I will give you a lot of gold if you will spare me!"}
        {MSGm_Ruvio _"Were you at Freetown?"}
        {MSG_Hoyre _"NO! That was Bor Cryne! Don't kill me!"}
        {MSGm_Ruvio _"I am an empty shell."}
        {BARURIEN}
    [/event]

    [event]
        {KILLEDBY (Hoyre O Barnone) (Gawen Hagarthen)}
        {MSGa_Gawen _"Before you will pass, I want to ask you one very simple question. Were you with the Akladian army which burned Freetown?"}
        {MSG_Hoyre _"No! No! That was Bor Cryne, I swear! I wasn't there!"}
        {VARIABLE ano_continue yes}
        {WHILE ano_continue equals yes}
        {MSGOPTI4 (Gawen Hagarthen) (portraits/gawen_matured.png) (_"Well..")
        (_"Where is Bor Cryne?") (bor)
        (_"Who gave you the location of Freetown?") (loc)
        (_"Do you know who poisoned my mother?") (mother)
        (_"That's all I wanted to know.") (all)
        }
        {IF ano_opt equals bor}
        {MSG_Hoyre _"Whenever he is, he should be here instead!"}
        {ELSE_IF ano_opt equals loc}
        {MSG_Hoyre _"I don't know! I wasn't at Freetown, really!"}
        {ELSE_IF ano_opt equals mother}
        {MSG_Hoyre _"I don't know! But Uri van Roe or Bor Cryne may know something about that..."}
        {ELSE}
        {VARIABLE ano_continue no}
        {TWO_END_IFs}
        {END_IF}
        {END_WHILE}

        {BARURIEN}
    [/event]

    [event]
        {KILLEDBY (Hoyre O Barnone) (Lady Lorin)}

        {MSG_Hoyre _"Don't kill me, Lorin! I knew you when you were a little child, I even played games with you when you were small..."}
        {MSGm_Lorin _"You should've killed me then, when you still had the chance."}

        {VARIABLE ano_continue yes}
        {WHILE ano_continue equals yes}
        {MSGOPTI3 (Lady Lorin) (portraits/lorin_wilczyca.png) (_"Well..")
        (_"Where is Bor Cryne?") (bor)
        (_"Who gave you the location of Freetown?") (loc)
        (_"That's all I wanted to know.") (all)
        }
        {IF ano_opt equals bor}
        {MSG_Hoyre _"Whenever he is, he should be here!"}
        {ELSE_IF ano_opt equals loc}
        {MSG_Hoyre _"I don't know! I wasn't at Freetown, really!"}
        {ELSE}
        {VARIABLE ano_continue no}
        {TWO_END_IFs}
        {END_WHILE}
        {BARURIEN}
    [/event]

    [event]
        name=last breath
        [filter]
            id=Bar Urien
        [/filter]
        {VARIABLE ano_urien dead}
        {MESSAGE (Bar Urien) () (_"Bar Urien") _"You truly are worthy to be our king! The Oracle was right! I never should have listened to Hoyre...."}
    [/event]

    [event]
        name=last breath
        [filter]
            id=Hoyre O Barnone
        [/filter]
        [filter_second]
            [not]
                id=Gawen Hagarthen
            [/not]
            [not]
                id=Lady Lorin
            [/not]
            [not]
                id=Ruvio
            [/not]
        [/filter_second]
        {MSG_Hoyre _"How could this be possible?"}
        {BARURIEN}
    [/event]

    [event]
        name=last breath
        [filter]
            id=Barhoon Urk
        [/filter]
        {MESSAGE (Barhoon Urk) () (_"Barhoon Urk") _"I should've stayed in hills in the north..."}
    [/event]

    {ALL_ANO_DEATHS}
    {ELVISH_DEATHS}
    {MAGE_DEATHS}
    {ELVISH_KILLING}
[/scenario]
